(()=>{var t={85:t=>{var e={bb:-2,b:-1,"":0,"#":1,x:2};t.exports=function(t){return e[t]},t.exports.interval=function(t){var n=e[t];return[-4*n,7*n]}},189:t=>{t.exports=function(t,e){return"number"==typeof t?(e=t,function(t){return e*Math.pow(2,(12*t[0]+7*t[1])/12)}):(e=e||440)*Math.pow(2,(12*t[0]+7*t[1])/12)}},269:t=>{var e=/^(AA|A|P|M|m|d|dd)(-?\d+)$/,n=[-4,7],r=["dd","d","P","A","AA"],o=["dd","d","m","M","A","AA"],i=[[0,0],[3,-5],[2,-3],[1,-1],[0,1],[3,-4],[2,-2],[1,0]];t.exports=function(t){var a=t.match(e);if(!a)return null;var s=a[1],u=+a[2],l=u<0?-1:1,c=(u=l<0?-u:u)>8?u%7||7:u,h=(u-c)/7,d=i[c-1],f=(d[0]<=1?r:o).indexOf(s)-2;return-3===f?null:[l*(d[0]+h+n[0]*f),l*(d[1]+n[1]*f)]},t.exports.coords=i.slice(0)},304:t=>{"use strict";function e(t){if(this.size=0|t,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var e=new Array(2*this.size),n=0;n<e.length;n+=2){const t=Math.PI*n/this.size;e[n]=Math.cos(t),e[n+1]=-Math.sin(t)}this.table=e;for(var r=0,o=1;this.size>o;o<<=1)r++;this._width=r%2==0?r-1:r,this._bitrev=new Array(1<<this._width);for(var i=0;i<this._bitrev.length;i++){this._bitrev[i]=0;for(var a=0;a<this._width;a+=2){var s=this._width-a-2;this._bitrev[i]|=(i>>>a&3)<<s}}this._out=null,this._data=null,this._inv=0}t.exports=e,e.prototype.fromComplexArray=function(t,e){for(var n=e||new Array(t.length>>>1),r=0;r<t.length;r+=2)n[r>>>1]=t[r];return n},e.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t},e.prototype.toComplexArray=function(t,e){for(var n=e||this.createComplexArray(),r=0;r<n.length;r+=2)n[r]=t[r>>>1],n[r+1]=0;return n},e.prototype.completeSpectrum=function(t){for(var e=this._csize,n=e>>>1,r=2;r<n;r+=2)t[e-r]=t[r],t[e-r+1]=-t[r+1]},e.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var t,e,n=this._out,r=this._csize,o=1<<this._width,i=r/o<<1,a=this._bitrev;if(4===i)for(t=0,e=0;t<r;t+=i,e++){const n=a[e];this._singleTransform2(t,n,o)}else for(t=0,e=0;t<r;t+=i,e++){const n=a[e];this._singleTransform4(t,n,o)}var s=this._inv?-1:1,u=this.table;for(o>>=2;o>=2;o>>=2){var l=(i=r/o<<1)>>>2;for(t=0;t<r;t+=i)for(var c=t+l,h=t,d=0;h<c;h+=2,d+=o){const t=h,e=t+l,r=e+l,o=r+l,i=n[t],a=n[t+1],c=n[e],f=n[e+1],m=n[r],v=n[r+1],g=n[o],p=n[o+1],y=i,b=a,w=u[d],M=s*u[d+1],_=c*w-f*M,A=c*M+f*w,P=u[2*d],x=s*u[2*d+1],I=m*P-v*x,E=m*x+v*P,S=u[3*d],C=s*u[3*d+1],B=g*S-p*C,T=g*C+p*S,L=y+I,F=b+E,k=y-I,q=b-E,N=_+B,z=A+T,V=s*(_-B),D=s*(A-T),$=L+N,j=F+z,K=L-N,H=F-z,O=k+D,W=q-V,R=k-D,U=q+V;n[t]=$,n[t+1]=j,n[e]=O,n[e+1]=W,n[r]=K,n[r+1]=H,n[o]=R,n[o+1]=U}}},e.prototype._singleTransform2=function(t,e,n){const r=this._out,o=this._data,i=o[e],a=o[e+1],s=o[e+n],u=o[e+n+1],l=i+s,c=a+u,h=i-s,d=a-u;r[t]=l,r[t+1]=c,r[t+2]=h,r[t+3]=d},e.prototype._singleTransform4=function(t,e,n){const r=this._out,o=this._data,i=this._inv?-1:1,a=2*n,s=3*n,u=o[e],l=o[e+1],c=o[e+n],h=o[e+n+1],d=o[e+a],f=o[e+a+1],m=o[e+s],v=o[e+s+1],g=u+d,p=l+f,y=u-d,b=l-f,w=c+m,M=h+v,_=i*(c-m),A=i*(h-v),P=g+w,x=p+M,I=y+A,E=b-_,S=g-w,C=p-M,B=y-A,T=b+_;r[t]=P,r[t+1]=x,r[t+2]=I,r[t+3]=E,r[t+4]=S,r[t+5]=C,r[t+6]=B,r[t+7]=T},e.prototype._realTransform4=function(){var t,e,n=this._out,r=this._csize,o=1<<this._width,i=r/o<<1,a=this._bitrev;if(4===i)for(t=0,e=0;t<r;t+=i,e++){const n=a[e];this._singleRealTransform2(t,n>>>1,o>>>1)}else for(t=0,e=0;t<r;t+=i,e++){const n=a[e];this._singleRealTransform4(t,n>>>1,o>>>1)}var s=this._inv?-1:1,u=this.table;for(o>>=2;o>=2;o>>=2){var l=(i=r/o<<1)>>>1,c=l>>>1,h=c>>>1;for(t=0;t<r;t+=i)for(var d=0,f=0;d<=h;d+=2,f+=o){var m=t+d,v=m+c,g=v+c,p=g+c,y=n[m],b=n[m+1],w=n[v],M=n[v+1],_=n[g],A=n[g+1],P=n[p],x=n[p+1],I=y,E=b,S=u[f],C=s*u[f+1],B=w*S-M*C,T=w*C+M*S,L=u[2*f],F=s*u[2*f+1],k=_*L-A*F,q=_*F+A*L,N=u[3*f],z=s*u[3*f+1],V=P*N-x*z,D=P*z+x*N,$=I+k,j=E+q,K=I-k,H=E-q,O=B+V,W=T+D,R=s*(B-V),U=s*(T-D),G=$+O,J=j+W,Y=K+U,Q=H-R;if(n[m]=G,n[m+1]=J,n[v]=Y,n[v+1]=Q,0!==d){if(d!==h){var X=K+-s*U,Z=-s*R-H,tt=$+-s*O,et=-j- -s*W,nt=t+c-d,rt=t+l-d;n[nt]=X,n[nt+1]=Z,n[rt]=tt,n[rt+1]=et}}else{var ot=$-O,it=j-W;n[g]=ot,n[g+1]=it}}}},e.prototype._singleRealTransform2=function(t,e,n){const r=this._out,o=this._data,i=o[e],a=o[e+n],s=i+a,u=i-a;r[t]=s,r[t+1]=0,r[t+2]=u,r[t+3]=0},e.prototype._singleRealTransform4=function(t,e,n){const r=this._out,o=this._data,i=this._inv?-1:1,a=2*n,s=3*n,u=o[e],l=o[e+n],c=o[e+a],h=o[e+s],d=u+c,f=u-c,m=l+h,v=i*(l-h),g=d+m,p=f,y=-v,b=d-m,w=f,M=v;r[t]=g,r[t+1]=0,r[t+2]=p,r[t+3]=y,r[t+4]=b,r[t+5]=0,r[t+6]=w,r[t+7]=M}},439:(t,e,n)=>{var r=n(633),o=n(644),i={aeolian:["P1","M2","m3","P4","P5","m6","m7"],blues:["P1","m3","P4","d5","P5","m7"],chromatic:["P1","m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"],dorian:["P1","M2","m3","P4","P5","M6","m7"],doubleharmonic:["P1","m2","M3","P4","P5","m6","M7"],harmonicminor:["P1","M2","m3","P4","P5","m6","M7"],ionian:["P1","M2","M3","P4","P5","M6","M7"],locrian:["P1","m2","m3","P4","d5","m6","m7"],lydian:["P1","M2","M3","A4","P5","M6","M7"],majorpentatonic:["P1","M2","M3","P5","M6"],melodicminor:["P1","M2","m3","P4","P5","M6","M7"],minorpentatonic:["P1","m3","P4","P5","m7"],mixolydian:["P1","M2","M3","P4","P5","M6","m7"],phrygian:["P1","m2","m3","P4","P5","m6","m7"],wholetone:["P1","M2","M3","A4","A5","A6"]};function a(t,e){if(!(this instanceof a))return new a(t,e);var n,r;if(!("coord"in t))throw new Error("Invalid Tonic");if("string"==typeof e){if(n=e,!(e=i[e]))throw new Error("Invalid Scale")}else for(r in i)if(i.hasOwnProperty(r)&&i[r].toString()===e.toString()){n=r;break}this.name=n,this.tonic=t,this.scale=e}i.harmonicchromatic=i.chromatic,i.minor=i.aeolian,i.major=i.ionian,i.flamenco=i.doubleharmonic,a.prototype={notes:function(){for(var t=[],e=0,n=this.scale.length;e<n;e++)t.push(this.tonic.interval(this.scale[e]));return t},simple:function(){return this.notes().map(function(t){return t.toString(!0)})},type:function(){var t=this.scale.length-2;if(t<8)return["di","tri","tetra","penta","hexa","hepta","octa"][t]+"tonic"},get:function(t){t="string"==typeof t&&t in r.stepNumber?r.stepNumber[t]:t;var e,n,i=this.scale.length;return t<0?(e=this.scale[t%i+i-1],n=Math.floor((t-1)/i)):t%i===0?(e=this.scale[i-1],n=t/i-1):(e=this.scale[t%i-1],n=Math.floor(t/i)),this.tonic.interval(e).interval(new o([n,0]))},solfege:function(t,e){return t?this.get(t).solfege(this,e):this.notes().map(function(t){return t.solfege(this,e)})},interval:function(t){return t="string"==typeof t?o.toCoord(t):t,new a(this.tonic.interval(t),this.scale)},transpose:function(t){var e=this.interval(t);return this.scale=e.scale,this.tonic=e.tonic,this}},a.KNOWN_SCALES=Object.keys(i),t.exports=a},443:t=>{var e={m:["m3","P5"],mi:["m3","P5"],min:["m3","P5"],"-":["m3","P5"],M:["M3","P5"],ma:["M3","P5"],"":["M3","P5"],"+":["M3","A5"],aug:["M3","A5"],dim:["m3","d5"],o:["m3","d5"],maj:["M3","P5","M7"],dom:["M3","P5","m7"],Ã¸:["m3","d5","m7"],5:["P5"],"6/9":["M3","P5","M6","M9"]};t.exports=function(t){var n,r,o="quality",i=[],a=2,s=["P1","M3","P5","m7","M9","P11","M13"],u=!1;function l(t){for(var n=e[t],r=0,o=n.length;r<o;r++)s[r+1]=n[r];a=n.length}for(var c=0,h=(t=t.replace(/[,\s\(\)]/g,"")).length;c<h;c++){if(!(n=t[c]))return;if("quality"===o){var d=c+2<h?t.substr(c,3).toLowerCase():null,f=c+1<h?t.substr(c,2).toLowerCase():null;(r=d in e?d:f in e?f:n in e?n:"")&&l(r),"M"!==r&&"ma"!==r&&"maj"!==r||(u=!0),c+=r.length-1,o="extension"}else if("extension"===o){if(n="1"===n&&t[c+1]?+t.substr(c,2):+n,isNaN(n)||6===n)6===n?(s[3]="M6",a=Math.max(3,a)):c-=1;else{if((a=(n-1)/2)!==Math.round(a))return new Error("Invalid interval extension: "+n.toString(10));"o"===r||"dim"===r?s[3]="d7":u&&(s[3]="M7"),c+=n>=10?1:0}o="alterations"}else if("alterations"===o){var m=t.substr(c).split(/(#|b|add|maj|sus|M)/i),v=!1,g=!1;if(1===m.length)return new Error("Invalid alteration");if(0!==m[0].length)return new Error("Invalid token: '"+m[0]+"'");var p=!1;m.forEach(function(t,e,n){if(p||!t.length)return p=!1;var r=n[e+1],o=t.toLowerCase();if("M"===t||"maj"===o)"7"===r&&(p=!0),a=Math.max(3,a),s[3]="M7";else if("sus"===o){var u="P4";"2"!==r&&"4"!==r||(p=!0,"2"===r&&(u="M2")),s[1]=u}else if("add"===o)"9"===r?i.push("M9"):"11"===r?i.push("P11"):"13"===r&&i.push("M13"),p=!0;else if("b"===o)v=!0;else if("#"===o)g=!0;else{var l,c,h=+t;if(isNaN(h)||String(h).length!==t.length)return new Error("Invalid token: '"+t+"'");if(6===h)return s[3]=g?"A6":v?"m6":"M6",void(a=Math.max(3,a));if(a<(c=(h-1)/2)&&(a=c),h<5||7===h||c!==Math.round(c))return new Error("Invalid interval alteration: "+h);l=s[c][0],g?"d"===l?l="m":"m"===l?l="M":"M"!==l&&"P"!==l||(l="A"):v&&("A"===l?l="M":"M"===l?l="m":"m"!==l&&"P"!==l||(l="d")),g=v=!1,s[c]=l+h}}),o="ended"}else if("ended"===o)break}return s.slice(0,a+1).concat(i)}},459:(t,e,n)=>{var r=n(443),o=n(633),i=n(825),a=n(644);function s(t,e){if(!(this instanceof s))return new s(t,e);e=e||"",this.name=t.name().toUpperCase()+t.accidental()+e,this.symbol=e,this.root=t,this.intervals=[],this._voicing=[];var n=e.split("/");if(2===n.length&&"9"!==n[1].trim()?(e=n[0],n=n[1].trim()):n=null,this.intervals=r(e).map(a.toCoord),this._voicing=this.intervals.slice(),n){var o,u,l=this.intervals;u=i.fromString(n+(t.octave()+1)),n=(o=a.between(t,u)).simple(),o=o.invert().direction("down"),this._voicing=[o];for(var c=0,h=l.length;c<h;c++)l[c].simple().equal(n)||this._voicing.push(l[c])}}s.prototype={notes:function(){var t=this.root;return this.voicing().map(function(e){return t.interval(e)})},simple:function(){return this.notes().map(function(t){return t.toString(!0)})},bass:function(){return this.root.interval(this._voicing[0])},voicing:function(t){if(!t)return this._voicing;this._voicing=[];for(var e=0,n=t.length;e<n;e++)this._voicing[e]=a.toCoord(t[e]);return this},resetVoicing:function(){this._voicing=this.intervals},dominant:function(t){return t=t||"",new s(this.root.interval("P5"),t)},subdominant:function(t){return t=t||"",new s(this.root.interval("P4"),t)},parallel:function(t){t=t||"";var e=this.quality();if("triad"!==this.chordType()||"diminished"===e||"augmented"===e)throw new Error("Only major/minor triads have parallel chords");return"major"===e?new s(this.root.interval("m3","down"),"m"):new s(this.root.interval("m3","up"))},quality:function(){for(var t,e,n,r=this.intervals,o=0,i=r.length;o<i;o++)3===r[o].number()?t=r[o]:5===r[o].number()?e=r[o]:7===r[o].number()&&(n=r[o]);if(t)return t=(t="down"===t.direction()?t.invert():t).simple().toString(),e&&(e=(e="down"===e.direction?e.invert():e).simple().toString()),n&&(n=(n="down"===n.direction?n.invert():n).simple().toString()),"M3"===t?"A5"===e?"augmented":"P5"===e&&"m7"===n?"dominant":"major":"m3"===t?"P5"===e?"minor":"d5"===e?"m7"===n?"half-diminished":"diminished":"minor":void 0},chordType:function(){var t,e,n,r,o,i=this.intervals.length;if(2===i)return"dyad";if(3===i){for(e={unison:!1,third:!1,fifth:!1},r=0;r<i;r++)n=(t=this.intervals[r]).invert(),t.base()in e?e[t.base()]=!0:n.base()in e&&(e[n.base()]=!0);o=e.unison&&e.third&&e.fifth?"triad":"trichord"}else if(4===i){for(e={unison:!1,third:!1,fifth:!1,seventh:!1},r=0;r<i;r++)n=(t=this.intervals[r]).invert(),t.base()in e?e[t.base()]=!0:n.base()in e&&(e[n.base()]=!0);e.unison&&e.third&&e.fifth&&e.seventh&&(o="tetrad")}return o||"unknown"},get:function(t){if("string"==typeof t&&t in o.stepNumber){var e,n,r=this.intervals;for(t=o.stepNumber[t],e=0,n=r.length;e<n;e++)if(r[e].number()===t)return this.root.interval(r[e]);return null}throw new Error("Invalid interval name")},interval:function(t){return new s(this.root.interval(t),this.symbol)},transpose:function(t){return this.root.transpose(t),this.name=this.root.name().toUpperCase()+this.root.accidental()+this.symbol,this},toString:function(){return this.name}},t.exports=s},490:t=>{t.exports={add:function(t,e){return[t[0]+e[0],t[1]+e[1]]},sub:function(t,e){return[t[0]-e[0],t[1]-e[1]]},mul:function(t,e){return"number"==typeof e?[t[0]*e,t[1]*e]:[t[0]*e[0],t[1]*e[1]]},sum:function(t){return t[0]+t[1]}}},538:t=>{var e={c:[0,0],d:[-1,2],e:[-2,4],f:[1,-1],g:[0,1],a:[-1,3],b:[-2,5],h:[-2,5]};t.exports=function(t){return t in e?[e[t][0],e[t][1]]:null},t.exports.notes=e,t.exports.A4=[3,3],t.exports.sharp=[-4,7]},633:t=>{t.exports={notes:{c:[0,0],d:[-1,2],e:[-2,4],f:[1,-1],g:[0,1],a:[-1,3],b:[-2,5],h:[-2,5]},intervals:{unison:[0,0],second:[3,-5],third:[2,-3],fourth:[1,-1],fifth:[0,1],sixth:[3,-4],seventh:[2,-2],octave:[1,0]},intervalFromFifth:["second","sixth","third","seventh","fourth","unison","fifth"],intervalsIndex:["unison","second","third","fourth","fifth","sixth","seventh","octave","ninth","tenth","eleventh","twelfth","thirteenth","fourteenth","fifteenth"],fifths:["f","c","g","d","a","e","b"],accidentals:["bb","b","","#","x"],sharp:[-4,7],A4:[3,3],durations:{.25:"longa",.5:"breve",1:"whole",2:"half",4:"quarter",8:"eighth",16:"sixteenth",32:"thirty-second",64:"sixty-fourth",128:"hundred-twenty-eighth"},qualityLong:{P:"perfect",M:"major",m:"minor",A:"augmented",AA:"doubly augmented",d:"diminished",dd:"doubly diminished"},alterations:{perfect:["dd","d","P","A","AA"],minor:["dd","d","m","M","A","AA"]},symbols:{min:["m3","P5"],m:["m3","P5"],"-":["m3","P5"],M:["M3","P5"],"":["M3","P5"],"+":["M3","A5"],aug:["M3","A5"],dim:["m3","d5"],o:["m3","d5"],maj:["M3","P5","M7"],dom:["M3","P5","m7"],Ã¸:["m3","d5","m7"],5:["P5"]},chordShort:{major:"M",minor:"m",augmented:"aug",diminished:"dim","half-diminished":"7b5",power:"5",dominant:"7"},stepNumber:{unison:1,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,octave:8,ninth:9,eleventh:11,thirteenth:13},intervalSolfege:{dd1:"daw",d1:"de",P1:"do",A1:"di",AA1:"dai",d2:"raw",m2:"ra",M2:"re",A2:"ri",AA2:"rai",d3:"maw",m3:"me",M3:"mi",A3:"mai",dd4:"faw",d4:"fe",P4:"fa",A4:"fi",AA4:"fai",dd5:"saw",d5:"se",P5:"so",A5:"si",AA5:"sai",d6:"law",m6:"le",M6:"la",A6:"li",AA6:"lai",d7:"taw",m7:"te",M7:"ti",A7:"tai",dd8:"daw",d8:"de",P8:"do",A8:"di",AA8:"dai"}}},644:(t,e,n)=>{var r=n(633),o=n(490),i=n(269);function a(t){if(!(this instanceof a))return new a(t);this.coord=t}a.prototype={name:function(){return r.intervalsIndex[this.number()-1]},semitones:function(){return o.sum(o.mul(this.coord,[12,7]))},number:function(){return Math.abs(this.value())},value:function(){var t=Math.floor((this.coord[1]-2)/7)+1,e=o.mul(r.sharp,t),n=o.sub(this.coord,e),i=r.intervalFromFifth[n[1]+5],a=n[0]-r.intervals[i][0],s=r.stepNumber[i]+7*a;return s>0?s:s-2},type:function(){return r.intervals[this.base()][0]<=1?"perfect":"minor"},base:function(){var t=o.mul(r.sharp,this.qualityValue()),e=o.sub(this.coord,t)[1];e=(e=this.value()>0?e+5:-(e-5)%7)<0?r.intervalFromFifth.length+e:e;var n=r.intervalFromFifth[e];return"unison"===n&&this.number()>=8&&(n="octave"),n},direction:function(t){return t?((this.value()>=1?"up":"down")!==t&&(this.coord=o.mul(this.coord,-1)),this):this.value()>=1?"up":"down"},simple:function(t){var e=r.intervals[this.base()],n=o.mul(r.sharp,this.qualityValue());return e=o.add(e,n),t||(e="down"===this.direction()?o.mul(e,-1):e),new a(e)},isCompound:function(){return this.number()>8},octaves:function(){var t,e;return"up"===this.direction()?(t=o.mul(r.sharp,this.qualityValue()),e=o.sub(this.coord,t)[0]-r.intervals[this.base()][0]):(t=o.mul(r.sharp,-this.qualityValue()),e=-(o.sub(this.coord,t)[0]+r.intervals[this.base()][0])),e},invert:function(){var t=this.base(),e=this.qualityValue(),n="minor"===this.type()?-(e-1):-e,i=9-r.stepNumber[t]-1,s=r.intervals[r.intervalsIndex[i]];return new a(s=o.add(s,o.mul(r.sharp,n)))},quality:function(t){var e=r.alterations[this.type()][this.qualityValue()+2];return t?r.qualityLong[e]:e},qualityValue:function(){return"down"===this.direction()?Math.floor((-this.coord[1]-2)/7)+1:Math.floor((this.coord[1]-2)/7)+1},equal:function(t){return this.coord[0]===t.coord[0]&&this.coord[1]===t.coord[1]},greater:function(t){var e=this.semitones(),n=t.semitones();return e===n?this.number()>t.number():e>n},smaller:function(t){return!this.equal(t)&&!this.greater(t)},add:function(t){return new a(o.add(this.coord,t.coord))},toString:function(t){var e=t?this.number():this.value();return this.quality()+e}},a.toCoord=function(t){var e=i(t);if(!e)throw new Error("Invalid simple format interval");return new a(e)},a.from=function(t,e){return t.interval(e)},a.between=function(t,e){return new a(o.sub(e.coord,t.coord))},a.invert=function(t){return a.toCoord(t).invert().toString()},t.exports=a},741:(t,e,n)=>{var r=n(538),o=n(85);t.exports=function(t){var e=t.match(/^([a-h])(x|#|bb|b?)(-?\d*)/i);if(e&&t===e[0]&&e[3].length){var n=e[1],i=+e[3],a=e[2].length?e[2].toLowerCase():"",s=o.interval(a),u=r(n.toLowerCase());return u[0]+=i,u[0]+=s[0]-r.A4[0],u[1]+=s[1]-r.A4[1],u}}},753:(t,e,n)=>{var r,o=n(825),i=n(644),a=n(459),s=n(439);function u(t,e){if("string"==typeof t)return i.toCoord(t);if("string"==typeof e&&t instanceof o)return i.from(t,i.toCoord(e));if(e instanceof i&&t instanceof o)return i.from(t,e);if(e instanceof o&&t instanceof o)return i.between(t,e);throw new Error("Invalid parameters")}function l(t,e){return"string"==typeof t?o.fromString(t,e):new o(t,e)}u.toCoord=i.toCoord,u.from=i.from,u.between=i.between,u.invert=i.invert,l.fromString=o.fromString,l.fromKey=o.fromKey,l.fromFrequency=o.fromFrequency,l.fromMIDI=o.fromMIDI,r={note:l,chord:function(t,e){var n,r;if("string"==typeof t){if((n=t.match(/^([a-h])(x|#|bb|b?)/i))&&n[0])return r="number"==typeof e?e.toString(10):"4",new a(o.fromString(n[0].toLowerCase()+r),t.substr(n[0].length))}else if(t instanceof o)return new a(t,e);throw new Error("Invalid Chord. Couldn't find note name")},interval:u,scale:function(t,e){return t=t instanceof o?t:r.note(t),new s(t,e)},Note:o,Chord:a,Scale:s,Interval:i},n(999)(r),t.exports=r},825:(t,e,n)=>{var r=n(741),o=n(910),i=n(189),a=n(633),s=n(490),u=n(644);function l(t,e,n){for(;n>0;n--)t+=e;return t}function c(t,e){if(!(this instanceof c))return new c(t,e);e=e||{},this.duration={value:e.value||4,dots:e.dots||0},this.coord=t}c.prototype={octave:function(){return this.coord[0]+a.A4[0]-a.notes[this.name()][0]+4*this.accidentalValue()},name:function(){var t=this.accidentalValue(),e=this.coord[1]+a.A4[1]-7*t+1;return a.fifths[e]},accidentalValue:function(){return Math.round((this.coord[1]+a.A4[1]-2)/7)},accidental:function(){return a.accidentals[this.accidentalValue()+2]},key:function(t){return t?7*this.coord[0]+4*this.coord[1]+29:12*this.coord[0]+7*this.coord[1]+49},midi:function(){return this.key()+20},fq:function(t){return i(this.coord,t)},chroma:function(){var t=(s.sum(s.mul(this.coord,[12,7]))-3)%12;return t<0?t+12:t},interval:function(t){return"string"==typeof t&&(t=u.toCoord(t)),t instanceof u?new c(s.add(this.coord,t.coord),this.duration):t instanceof c?new u(s.sub(t.coord,this.coord)):void 0},transpose:function(t){return this.coord=s.add(this.coord,t.coord),this},helmholtz:function(){var t=this.octave(),e=this.name(),n=t<3?",":"'",r=t<2?2-t:t-3;return l((e=t<3?e.toUpperCase():e.toLowerCase())+this.accidental(),n,r)},scientific:function(){return this.name().toUpperCase()+this.accidental()+this.octave()},enharmonics:function(t){var e=this.key(),n=t?2:3;return["m3","m2","m-2","m-3"].map(this.interval.bind(this)).filter(function(t){var r=t.accidentalValue(),o=e-(t.key()-r);if(o<n&&o>-n){var i=s.mul(a.sharp,o-r);return t.coord=s.add(t.coord,i),!0}})},solfege:function(t,e){var n,r,o,i=t.tonic.interval(this);return"down"===i.direction()&&(i=i.invert()),e&&(r=(o=(o=(this.key(!0)-t.tonic.key(!0))/7)>=0?Math.floor(o):-Math.ceil(-o))>=0?"'":","),n=a.intervalSolfege[i.simple(!0).toString()],e?l(n,r,Math.abs(o)):n},scaleDegree:function(t){var e=t.tonic.interval(this);return("down"===e.direction()||0===e.coord[1]&&0!==e.coord[0])&&(e=e.invert()),e=e.simple(!0).coord,t.scale.reduce(function(t,n,r){var o=u.toCoord(n).coord;return o[0]===e[0]&&o[1]===e[1]?r+1:t},0)},durationName:function(){return a.durations[this.duration.value]},durationInSeconds:function(t,e){var n=60/t/(this.duration.value/4)/(e/4);return 2*n-n/Math.pow(2,this.duration.dots)},toString:function(t){return this.name()+this.accidental()+(t?"":this.octave())}},c.fromString=function(t,e){var n=r(t);return n||(n=o(t)),new c(n,e)},c.fromKey=function(t){var e=Math.floor((t-4)/12),n=t-12*e-4,r=a.fifths[(2*Math.round(n/2)+1)%7],o=s.sub(a.notes[r],a.A4),i=s.add(o,[e+1,0]),u=t-49-s.sum(s.mul(i,[12,7]));return new c(u?s.add(i,s.mul(a.sharp,u)):i)},c.fromFrequency=function(t,e){var n,r,o;return e=e||440,n=49+(Math.log(t)-Math.log(e))/Math.log(2)*12,n=Math.round(n),o=e*Math.pow(2,(n-49)/12),r=Math.log(t/o)/Math.log(2)*1200,{note:c.fromKey(n),cents:r}},c.fromMIDI=function(t){return c.fromKey(t-20)},t.exports=c},910:(t,e,n)=>{var r=n(538),o=n(85);t.exports=function(t){var e=(t=t.replace(/\u2032/g,"'").replace(/\u0375/g,",")).match(/^(,*)([a-h])(x|#|bb|b?)([,\']*)$/i);if(!e||t!==e[0])throw new Error("Invalid formatting");var n,i=e[2],a=e[1],s=e[4],u=i===i.toLowerCase();if(a){if(u)throw new Error("Invalid formatting - found commas before lowercase note");n=2-a.length}else if(s)if(s.match(/^'+$/)&&u)n=3+s.length;else{if(!s.match(/^,+$/)||u)throw new Error("Invalid formatting - mismatch between octave indicator and letter case");n=2-s.length}else n=u?3:2;var l=o.interval(e[3].toLowerCase()),c=r(i.toLowerCase());return c[0]+=n,c[0]+=l[0]-r.A4[0],c[1]+=l[1]-r.A4[1],c}},999:(t,e,n)=>{var r=n(633);t.exports=function(t){var e=t.Note,n=t.Chord,o=t.Scale;e.prototype.chord=function(t){return t=t in r.chordShort?r.chordShort[t]:t,new n(this,t)},e.prototype.scale=function(t){return new o(this,t)}}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}(()=>{"use strict";var t=n(304);class e{_inputLength;_fft;_bufferSupplier;_paddedInputBuffer;_transformBuffer;_inverseBuffer;static forFloat32Array(t){return new e(t,t=>new Float32Array(t))}static forFloat64Array(t){return new e(t,t=>new Float64Array(t))}static forNumberArray(t){return new e(t,t=>Array(t))}constructor(e,n){if(e<1)throw new Error("Input length must be at least one");var r;this._inputLength=e,this._fft=new t((r=2*e,r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,++r)),this._bufferSupplier=n,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}get inputLength(){return this._inputLength}autocorrelate(t,e=this._bufferSupplier(t.length)){if(t.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${t.length}`);for(let e=0;e<t.length;e++)this._paddedInputBuffer[e]=t[e];for(let e=t.length;e<this._paddedInputBuffer.length;e++)this._paddedInputBuffer[e]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const n=this._transformBuffer;for(let t=0;t<n.length;t+=2)n[t]=n[t]*n[t]+n[t+1]*n[t+1],n[t+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let n=0;n<t.length;n++)e[n]=this._inverseBuffer[2*n];return e}}class r{_autocorrelator;_nsdfBuffer;_clarityThreshold=.9;static forFloat32Array(t){return new r(t,t=>new Float32Array(t))}static forFloat64Array(t){return new r(t,t=>new Float64Array(t))}static forNumberArray(t){return new r(t,t=>Array(t))}constructor(t,n){this._autocorrelator=new e(t,n),this._nsdfBuffer=n(t)}get inputLength(){return this._autocorrelator.inputLength}findPitch(t,e){this._nsdf(t);const n=function(t){const e=[];let n=!1,r=-1/0,o=-1;for(let i=1;i<t.length-1;i++)t[i-1]<=0&&t[i]>0?(n=!0,o=i,r=t[i]):t[i-1]>0&&t[i]<=0?(n=!1,-1!==o&&e.push(o)):n&&t[i]>r&&(r=t[i],o=i);return e}(this._nsdfBuffer);if(0===n.length)return[0,0];const r=Math.max(...n.map(t=>this._nsdfBuffer[t])),o=n.find(t=>this._nsdfBuffer[t]>=this._clarityThreshold*r),[i,a]=function(t,e){const[n,r,o]=[t-1,t,t+1],[i,a,s]=[e[n],e[r],e[o]],u=i/2-a+s/2,l=-i/2*(r+o)+a*(n+o)-s/2*(n+r),c=-l/(2*u);return[c,u*c*c+l*c+(i*r*o/2-a*n*o+s*n*r/2)]}(o,this._nsdfBuffer);return[e/i,Math.min(a,1)]}_nsdf(t){this._autocorrelator.autocorrelate(t,this._nsdfBuffer);let e,n=2*this._nsdfBuffer[0];for(e=0;e<this._nsdfBuffer.length&&n>0;e++)this._nsdfBuffer[e]=2*this._nsdfBuffer[e]/n,n-=t[e]**2+t[t.length-e-1]**2;for(;e<this._nsdfBuffer.length;e++)this._nsdfBuffer[e]=0}}var o=n(753);let i=[],a=!1,s=!1,u=440;function l(t,e){const n=function(t){const e=[];for(let n=2;n<=6;n++){const r=o.scale(o.note(t+n),"major");e.push(...r.notes().map(t=>t.fq()))}return[...new Set(e)].sort((t,e)=>t-e)}(t.notes()[0].name().replace(/\d/,""));let r=n[0],i=Math.abs(e-r);for(const t of n){const n=Math.abs(e-t);n<i&&(i=n,r=t)}const a=o.note.fromFrequency(r);if(!a||!a.note)return null;const s=a.note,u=Math.round((e-r)/r*1200),l=o.note.fromFrequency(e);if(!l||!l.note)return null;const c=l.note,h=c.name();return{detectedNote:c,targetNote:s,cents:u,inKey:t.notes().map(t=>t.name()).includes(h)}}function c(){a=!0,localStorage.setItem("debugMode","true")}function h(){s=!0;const t=document.getElementById("debug-panel");t&&(t.style.display="block"),localStorage.setItem("debugPanelVisible","true")}function d(){s=!1;const t=document.getElementById("debug-panel");t&&(t.style.display="none"),localStorage.setItem("debugPanelVisible","false")}async function f(t=null){try{const e={audio:!t||{deviceId:{exact:t}}},n=await navigator.mediaDevices.getUserMedia(e),o=new AudioContext({}),i=o.createAnalyser();i.minDecibels=-50,i.maxDecibels=-10,i.smoothingTimeConstant=.85,o.createMediaStreamSource(n).connect(i);const a=r.forFloat32Array(i.fftSize);return window.pitchDetector=a,window.analyzer=i,window.audioCtx=o,!0}catch(t){return console.error("Error accessing microphone:",t),!1}}function m(t,e){if(t&&t[1]>.95&&e){const n=getComputedStyle(document.documentElement),r=n.getPropertyValue("--primary-color").trim(),o=n.getPropertyValue("--secondary-color").trim();document.documentElement.style.setProperty("--gradient-primary",e.inKey?r:o);const i=document.getElementById("cents-gradient");if(i){const t=Math.max(0,Math.min(100,50+50*e.cents/50));i.style.setProperty("--cents-position",`${t}%`)}const a=document.getElementById("note-name"),s=document.getElementById("frequency"),u=document.getElementById("cents");if(a){const t=e.detectedNote.accidental(),n="b"===t?"â™­":"#"===t?"â™¯":"";a.textContent=`${e.detectedNote.name()}${n}`}if(s&&(s.textContent=`${t[0].toFixed(1)} Hz`),u){const t=Math.round(e.cents),n=t>0?`+${t}`:t.toString();u.textContent=`${n} cents`}}else{const t=document.getElementById("note-name"),e=document.getElementById("frequency"),n=document.getElementById("cents"),r=document.getElementById("cents-gradient");t&&(t.textContent="--"),e&&(e.textContent="-- Hz"),n&&(n.textContent="-- cents"),r&&r.style.setProperty("--cents-position","50%")}}function v(t,e,n,r,i,a,s,u){const l=o.note(e),c=l.name().toUpperCase()+(l.accidental()||""),h=["C","G","D","A","E","B","F#","C#"].indexOf(c),d=["C","F","Bb","Eb","Ab","Db","Gb","Cb"].indexOf(c),f=-1!==h,m=f?h:-1!==d?d:0;if(0===m)return;const v=f?"treble"===u?[7.5,4.5,8.5,5.5,2.5,6.5,3.5]:[5.5,2.5,6.5,3.5,.5,4.5,1.5]:"treble"===u?[4.5,7.5,3.5,6.5,2.5,5.5,1.5]:[2.5,5.5,1.5,4.5,.5,3.5,-.5],g=f?"â™¯":"â™­",p=Math.round(.12*s);t.font=`${p}px serif`,t.fillStyle=a;let y=n;for(let e=0;e<m;e++){const n=r+v[e]*(i/2);t.fillText(g,y,n+.25*p),y+=.3*p}}function g(t,e,n,r){try{let o=t.midi();const i=t.accidental();let a;return"#"===i?o-=1:"b"===i&&(o+=1),a=o>=60?e+4*r-4*r/13*(o-64):n+4*r-4*r/14*(o-43),a}catch(n){return console.error("Error in getYForNote:",n,"note:",t),e+2*r}}function p(){const t=document.getElementById("settings-modal");t&&(t.setAttribute("aria-hidden","true"),document.body.style.overflow="")}let y="C";function b(t){const e=document.documentElement;"auto"===t?e.removeAttribute("data-theme"):e.setAttribute("data-theme",t),localStorage.setItem("theme",t)}function w(t){y=t,localStorage.setItem("key",t)}function M(){if(a)i.push([u,.96]);else{const t=window.pitchDetector,e=window.analyzer,n=window.audioCtx;if(t&&e&&n){const r=new Float32Array(t.inputLength);e.getFloatTimeDomainData(r);const o=t.findPitch(r,n.sampleRate);o&&i.push(o)}}i.length>100&&i.shift(),window.requestAnimationFrame(()=>function(t){const e=document.getElementById("pitches");if(!e)return;const n=e.parentNode,r=n.clientWidth,a=n.clientHeight,s=Math.min(a,400),u=Math.min(r,1200);e.width=u,e.height=s,e.style.width=u+"px",e.style.height=s+"px";const c=e.getContext("2d");c.reset();const h=getComputedStyle(document.documentElement),d=h.getPropertyValue("--primary-color").trim(),f=h.getPropertyValue("--secondary-color").trim(),p=h.getPropertyValue("--accent-color").trim(),y=h.getPropertyValue("--text-color").trim(),b=t,w=o.scale(o.note(b),"major"),M=Math.max(15,Math.round(.03*u)),_=u-M-Math.max(20,Math.round(.05*u)),A=Math.round(.048*s),P=Math.round(e.height/2-5*A),x=Math.max(2,Math.round(.003*u));c.strokeStyle=y,c.lineWidth=x,c.lineCap="round";for(let t=0;t<5;t++){const e=P+t*A;c.moveTo(M,e),c.lineTo(M+_,e)}const I=P+6*A;for(let t=0;t<5;t++){const e=I+t*A;c.moveTo(M,e),c.lineTo(M+_,e)}c.lineWidth=x,c.moveTo(M,P),c.lineTo(M,I+4*A),c.moveTo(M+_,P),c.lineTo(M+_,I+4*A),c.stroke(),c.fillStyle=y;const E=Math.round(.16*s);c.font=`bold ${E}px serif`;const S=P+3.75*A+Math.round(.018*s);c.fillText("ð„ž",M+Math.round(.008*u),S);const C=I+2.75*A+Math.round(.018*s);c.fillText("ð„¢",M+Math.round(.008*u),C);const B=M+Math.round(.067*u);if(v(c,b,B,P,A,y,s,"treble"),v(c,b,B,I,A,y,s,"bass"),i.length<1)return void m([0,0],null);const T=M+.75*_,L=.5*_,F=T,k=Math.max(M,T-L),q=c.strokeStyle,N=c.lineWidth,z=c.globalAlpha;c.lineWidth=Math.max(4,Math.round(.005*u)),c.lineCap="round",c.lineJoin="round";const V=F,D=i[i.length-1];if(!D||D[1]<=.95||D[0]<20)return void m(D,null);const $=l(w,D[0]);if(!$)return void m(D,null);const j=g($.targetNote,P,I,A),K=Math.min(50,i.length),H=[],O=[];for(let t=Math.max(0,i.length-K);t<i.length;t++){const e=i[t];if(e[1]>.95&&e[0]>20){const n=l(w,e[0]);n&&O.push({cents:n.cents,note:n.targetNote,index:t,inKey:n.inKey})}}const W=T-k,R=O.length>1?W/(O.length-1):0;if(O.forEach((t,e)=>{const n=T-(O.length-1-e)*R,r=g(t.note,P,I,A);H.push({x:n,y:r,cents:t.cents,age:O.length-e-1,inKey:t.inKey})}),H.length>0){const t=H.reduce((t,e)=>t+e.y,0)/H.length,e=H[0].x,n=V,r=c.createLinearGradient(e,t,n,t);H.forEach(t=>{let o=d;(!t.inKey||Math.abs(t.cents)>10)&&(o=t.cents>10?f:t.cents<-10?p:f);const i=1-t.age/(H.length-1||1),a=o.replace(/rgb\(([^)]+)\)/,`rgba($1, ${i})`),s=(t.x-e)/(n-e);r.addColorStop(s,a)});let o=d;$.cents>10?o=f:$.cents<-10&&(o=p),r.addColorStop(1,o),c.strokeStyle=r,c.globalAlpha=.5,c.lineWidth=Math.max(4,Math.round(.0025*u)),c.beginPath(),c.moveTo(H[0].x,H[0].y),H.slice(1).forEach(t=>{c.lineTo(t.x,t.y)}),c.lineTo(V,j),c.stroke()}c.strokeStyle=q,c.lineWidth=N,c.globalAlpha=z;const U=i[i.length-1];let G=null;if(U[1]>.95&&(G=l(w,U[0]),G)){const t=g(G.targetNote,P,I,A),n=Math.round(.04*u),r=Math.max(n,Math.min(e.height-10,t)),o=c.createRadialGradient(F,r,1,F,r,n);let i=d;(!G.inKey||Math.abs(G.cents)>10)&&(i=G.cents>10?f:G.cents<-10?p:f),o.addColorStop(0,i),c.beginPath(),c.arc(F,r,n,0,2*Math.PI),o.addColorStop(.7,"rgba(0,0,0,0)"),c.fillStyle=o,c.fill()}m(U,G)}(y))}document.addEventListener("DOMContentLoaded",async()=>{b(localStorage.getItem("theme")||"auto"),w(localStorage.getItem("key")||"C");const t="true"===localStorage.getItem("debugMode"),e="true"===localStorage.getItem("debugPanelVisible");if(t){c();const t=document.getElementById("debug-toggle");t&&(t.checked=!0)}e?h():d();const n=document.getElementById("key-select");n&&(n.value=y);const r=document.getElementById("debug-frequency"),o=document.getElementById("frequency-display");r&&(r.value=u.toString()),o&&(o.textContent=u.toFixed(1)+" Hz");const i=document.getElementById("settings-button"),l=document.getElementById("debug-button"),m=document.getElementById("close-settings"),v=document.getElementById("modal-backdrop"),g=document.getElementById("mic-button-modal"),_=document.getElementById("mic-select-modal"),A=document.getElementById("theme-select");i&&i.addEventListener("click",()=>{!async function(){try{const t=(await navigator.mediaDevices.enumerateDevices()).filter(t=>"audioinput"===t.kind),e=document.getElementById("mic-select-modal");e&&(e.innerHTML='<option value="">Default</option>',t.forEach(t=>{const n=document.createElement("option");n.value=t.deviceId,n.textContent=t.label||`Microphone ${e.options.length}`,e.appendChild(n)}))}catch(t){console.warn("Could not enumerate microphones:",t)}}(),function(){const t=document.getElementById("settings-modal");if(t){t.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden";const e=document.getElementById("theme-select");if(e){const t=document.documentElement.getAttribute("data-theme")||"auto";e.value="auto"===t?"auto":t}}}()}),l&&l.addEventListener("click",()=>{s?d():h()}),m&&m.addEventListener("click",p),v&&v.addEventListener("click",p),g&&g.addEventListener("click",async()=>{const t=_?_.value:null;await f(t)&&p()}),A&&A.addEventListener("change",t=>{b(t.target.value)}),n&&n.addEventListener("change",t=>{w(t.target.value)});const P=document.getElementById("debug-toggle"),x=document.getElementById("debug-frequency");P&&P.addEventListener("change",t=>{t.target instanceof HTMLInputElement&&(t.target.checked?c():(a=!1,localStorage.setItem("debugMode","false")))}),x&&x.addEventListener("input",t=>{if(t.target instanceof HTMLInputElement){const e=parseFloat(t.target.value);!isNaN(e)&&e>=20&&e<=1e3&&(function(t){u=t}(e),o&&(o.textContent=e.toFixed(1)+" Hz"))}}),document.addEventListener("keydown",t=>{if("Escape"===t.key){const t=document.getElementById("settings-modal");t&&"false"===t.getAttribute("aria-hidden")&&p()}}),await f(),setInterval(M,25)})})()})();